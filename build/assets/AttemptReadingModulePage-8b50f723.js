import{j as e,h as se,a as M,b as h,k as B,c as l,y as te,z as ne,r as n,i as ie,g as oe,u as ae,A as re,S as le,G as ce,e as de}from"./index-987d2413.js";import{M as ue}from"./MiniNavBar-60e3dbb0.js";import{C as me}from"./CountdownTimer-0ca7da93.js";import{Q as xe,g as he}from"./QuestionPallete-ed8dbb20.js";import{R as pe,a as fe}from"./ReadingPassage-b942654b.js";import{B as je}from"./BookInfo-90ebd7bb.js";import{C as we}from"./CustomSplitPane-f02147d0.js";import{M as a}from"./Modal-34675219.js";import{T as ge}from"./Table-56299a44.js";import"./ButtonGroup-4e6dbc58.js";import"./ParseQuestions-99662847.js";const Se=({isExpanded:d,toggleExpanded:p,deviceType:f,module:j,questionData:w,setShowReviewModal:u,userAllAnswer:t,setShowSubmitModal:g,handleConfirmEndTest:i})=>e.jsx("div",{className:"fixed-footer border-top",style:{height:d?"50vh":"50px",width:"100vw",position:"fixed",bottom:0,backgroundColor:"white",transition:"height 0.3s",zIndex:"999"},children:e.jsxs(se,{children:[e.jsxs(M,{className:"mt-1 pb-1 border-bottom text-black",children:[e.jsx(h,{className:"col-4 mt-1",children:e.jsx("div",{children:e.jsxs("span",{style:{fontSize:"20px"},children:[e.jsx(B,{className:"",style:{marginRight:"5px"}}),w.completed_questions,"/",j.total_questions]})})}),e.jsx(h,{className:"col-4 text-center mt-1",children:e.jsx(me,{initialMinutes:40,initialSeconds:0,handleTimesUp:i})}),e.jsxs(h,{className:"col-4",style:{textAlign:"right"},children:[f!=="mobile"&&e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"outline-primary",className:"mx-1",onClick:()=>{u(!0)},children:"Review"}),e.jsx(l,{variant:"outline-primary",className:"mx-1",onClick:g,children:"Submit Test"})]}),e.jsx(l,{className:"mx-1",onClick:()=>p(!d),children:d?e.jsx(te,{size:20}):e.jsx(ne,{size:20})})]})]}),e.jsxs(M,{className:"my-3",style:{overflow:"auto",maxHeight:"38vh"},children:[e.jsxs(h,{lg:"8",className:"my-2",children:[e.jsx("p",{className:" fw-bold text-black mb-1 mx-1",children:"Question Pallete"}),e.jsx(xe,{module:j,currentFormData:t})]}),e.jsx(h,{lg:"4",children:f==="mobile"&&e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"outline-primary",className:"mx-1",onClick:()=>{u(!0)},children:"Review"}),e.jsx(l,{variant:"outline-primary",className:"mx-1",onClick:g,children:"Submit Test"})]})})]})]})}),Be=()=>{const[d,p]=n.useState("desktop"),[f,j]=n.useState(!1),{module_slug:w,attempt_slug:u}=ie(),[t,g]=n.useState(null),[i,m]=n.useState(null),[be,E]=n.useState({}),[c,z]=n.useState({}),[_,P]=n.useState(null),[x,y]=n.useState({}),[D,U]=n.useState({completed_questions:0}),[q,C]=n.useState(!1),N=()=>C(!1),[H,k]=n.useState(!1),A=()=>k(!1),R=n.useRef(null),T=oe(),[L,S]=n.useState(!1),b=()=>S(!1),Q=ae();n.useRef(null),n.useRef(null);const O=i?i.id===t.sections[0].id:!1,Y=i?i.id===t.sections[t.sections.length-1].id:!1;n.useEffect(()=>{J()},[]),n.useEffect(()=>{if(i){const s=c[i.id];P(s),window.scrollTo(0,0)}},[i]),n.useEffect(()=>{const s=()=>{window.innerWidth<768?p("mobile"):p("desktop")};return s(),window.addEventListener("resize",s),()=>{window.removeEventListener("resize",s)}},[]),n.useEffect(()=>{v(),V()},[t]),n.useEffect(()=>{if(c){let s=0;Object.keys(c).map(o=>Object.keys(c[o]).map(r=>c[o][r]!==void 0&&c[o][r]!==""&&s++)),U({completed_questions:s})}},[c]);function v(){if(i!=null){const s=he(R,t,E);return z({...c,[i.id]:s}),y({...x,...s}),s}else return null}const $=s=>{s.preventDefault(),Z()},G=s=>{v()};function K(){const o=t.sections.findIndex(r=>r.id===i.id)-1;o>=0?m(t.sections[o]):m(t.sections[t.sections.length-1])}function W(){const o=t.sections.findIndex(r=>r.id===i.id)+1;o<t.sections.length?m(t.sections[o]):m(t.sections[0])}async function J(){const s=await T.post(re.getReadingModule+w+"/");s.status===200&&(g(s.data),m(s.data.sections[0]))}function F(s){const o=t.sections.find(r=>r.id===s);m(o)}function V(){if(t){const s=t.total_questions;let o={};Array.from({length:s},(r,ee)=>ee+1).map(r=>o["que-"+r]=""),y(o)}}function X(s="In Progress"){const o={answers:x,attempt_type:s};return T.post("/ieltstest/update_attempt/reading/"+u+"/",o)}function Z(){handleShowModal()}function I(){v(),X("Completed").then(s=>{s.status===200&&(console.log("Attempt Updated"),Q(`/ieltstest/attempt/reading/${w}/${u}/get_result`))}).catch(s=>{console.error("Error updating attempt: ",s)}),b()}return n.useEffect(()=>{document.title="Reading Test | KeenIELTS"},[]),t?e.jsxs(e.Fragment,{children:[e.jsx(ue,{module:t,currentSection:i,updateCurrentSection:F,setShowTestInfoModal:k}),e.jsx(we,{deviceType:d,currentSection:i,left:e.jsx(e.Fragment,{children:e.jsx(pe,{section:i})}),right:e.jsxs(e.Fragment,{children:[e.jsx(fe,{section:i,handleChange:G,handleSubmit:$,formRef:R,section_form_values:_},i.id),e.jsxs(le,{direction:"horizontal",className:"border-top pt-3",children:[e.jsx("div",{className:"m-0",children:e.jsxs(l,{variant:"dark",className:"btn-sm",onClick:K,disabled:O,children:[e.jsx(ce,{size:20})," Previous Section"]})}),e.jsx("div",{className:"m-0 ms-auto",children:Y?e.jsxs(l,{variant:"primary",className:"btn-sm",onClick:()=>{S(!0)},children:["Submit Test ",e.jsx(B,{size:20})]}):e.jsxs(l,{variant:"dark",className:"btn-sm",onClick:W,children:["Next Section ",e.jsx(de,{size:20})]})})]})]})}),e.jsx(Se,{isExpanded:f,toggleExpanded:j,deviceType:d,module:t,updateCurrentSection:F,questionData:D,setShowReviewModal:C,userAllAnswer:x,setShowSubmitModal:S,handleConfirmEndTest:I}),e.jsxs(a,{show:L,onHide:b,centered:!0,children:[e.jsx(a.Header,{closeButton:!0,children:e.jsx(a.Title,{children:"End Test"})}),e.jsx(a.Body,{children:"Are you sure you want to end the test?"}),e.jsxs(a.Footer,{className:"p-2",children:[e.jsx(l,{variant:"outline-primary",onClick:b,children:"No"}),e.jsx(l,{variant:"primary",onClick:I,children:"Yes, end test"})]})]}),e.jsxs(a,{show:q,onHide:N,centered:!0,className:"p-0",children:[e.jsx(a.Header,{closeButton:!0,children:e.jsx(a.Title,{children:"Review Answers"})}),e.jsx(a.Body,{children:e.jsxs(ge,{striped:!0,bordered:!0,size:"sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",children:"#"}),e.jsx("th",{scope:"col",children:"Your Answer"})]})}),e.jsx("tbody",{children:Object.keys(x).map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.split("-")[1]}),e.jsx("td",{className:"fw-bold text-black",children:x[s]})]},s))})]})}),e.jsx("div",{class:"modal-footer py-2",children:e.jsx("button",{type:"button",class:"btn btn-outline-primary",onClick:N,children:"Close"})})]}),e.jsxs(a,{show:H,onHide:A,centered:!0,className:"p-0",children:[e.jsx(a.Header,{closeButton:!0,children:e.jsx(a.Title,{children:"Test Info"})}),e.jsx(a.Body,{className:"p-0",children:e.jsx(je,{module:t,attempt_slug:u})}),e.jsx("div",{className:"modal-footer py-2",children:e.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:A,children:"Close"})})]})]}):null};export{Be as default};
//# sourceMappingURL=AttemptReadingModulePage-8b50f723.js.map
